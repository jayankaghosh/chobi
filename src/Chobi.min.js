"use strict";var Chobi=function(a){if(a instanceof Image){this.image=a,this.imageData=this.extractImageData(),console.log("Type matched. instanceof(Image). Saved as [Chobi object]");try{this.onload()}catch(t){console.log("ready callback not found")}}else if("string"==typeof a){var e=this;console.log("Not instanceof(Image). Trying as URL");var o=new Image;o.crossOrigin="Anonymous",o.src=a,o.onload=function(){e.image=o,e.imageData=e.extractImageData(),console.log("Type matched. URL. Saved as [Chobi object]");try{e.onload()}catch(a){console.log("ready callback not found")}}}else{console.log("Not instanceof(Image). Trying as URL"),console.log("Not URL. Trying as input[file]");var e=this;try{var i=a.files[0],n=new FileReader;n.onload=function(){var a=new Image;a.onload=function(){e.image=a,e.imageData=e.extractImageData(),console.log("Type matched. input[file]. Saved as [Chobi object]");try{e.onload()}catch(t){console.log("ready callback not found")}},a.src=n.result},n.readAsDataURL(i)}catch(t){console.log("Not input[file]. Trying as <canvas>")}try{var o=new Image,r=a.toDataURL();o.src=r,console.log(r),o.onload=function(){e.image=o,e.imageData=e.extractImageData(),console.log("Type matched. <canvas>. Saved as [Chobi object]");try{e.onload()}catch(a){console.log("ready callback not found")}}}catch(t){console.log("Not <canvas>. Trying as <img>")}try{var o=new Image;o.src=a.src,o.onload=function(){e.image=o,e.imageData=e.extractImageData(),console.log("Type matched. <img>. Saved as [Chobi object]");try{e.onload()}catch(a){console.log("ready callback not found")}}}catch(t){console.log("Not <img>. No other type is supported")}}};Chobi.prototype.ready=function(a){this.onload=a},Chobi.prototype.onload=null,Chobi.prototype.extractImageData=function(){var a=this.image,t=document.createElement("canvas"),e=t.getContext("2d");return t.width=a.width,t.height=a.height,e.drawImage(a,0,0,a.width,a.height),this.imageData=e.getImageData(0,0,a.width,a.height),this.imageData},Chobi.prototype.getColorAt=function(a,t){var e=4*t*this.imageData.width+4*a,o={red:this.imageData.data[e],green:this.imageData.data[e+1],blue:this.imageData.data[e+2],alpha:this.imageData.data[e+3]};return o},Chobi.prototype.setColorAt=function(t,e,o){var i=4*e*this.imageData.width+4*t;try{return r=o.red,g=o.green,b=o.blue,a=o.alpha,this.imageData.data[i]=r,this.imageData.data[i+1]=g,this.imageData.data[i+2]=b,this.imageData.data[i+3]=a,!0}catch(n){return!1}},Chobi.prototype.blackAndWhite=function(){for(var a=this.imageData,t=0;t<a.width;t++)for(var e=0;e<a.height;e++){var o=4*e*a.width+4*t,i=a.data[o],n=a.data[o+1],r=a.data[o+2],h=(i+n+r)/3;a.data[o]=h,a.data[o+1]=h,a.data[o+2]=h}return this},Chobi.prototype.sepia=function(){for(var a=this.imageData,t=0;t<a.width;t++)for(var e=0;e<a.height;e++){var o=4*e*a.width+4*t,i=a.data[o],n=a.data[o+1],r=a.data[o+2];a.data[o]=.393*i+.769*n+.189*r,a.data[o+1]=.349*i+.686*n+.168*r,a.data[o+2]=.272*i+.534*n+.131*r}return this},Chobi.prototype.negative=function(){for(var a=this.imageData,t=0;t<a.width;t++)for(var e=0;e<a.height;e++){var o=4*e*a.width+4*t,i=a.data[o],n=a.data[o+1],r=a.data[o+2];a.data[o+3];i=255-i,n=255-n,r=255-r,a.data[o]=i,a.data[o+1]=n,a.data[o+2]=r}return this},Chobi.prototype.contrast=function(a){var t=(255+a)/255;t*=t;for(var e=this.imageData,o=0;o<e.width;o++)for(var i=0;i<e.height;i++){var n=4*i*e.width+4*o,r=e.data[n],h=e.data[n+1],d=e.data[n+2],c=r/255,g=h/255,s=d/255;c=255*((c-.5)*t+.5),g=255*((g-.5)*t+.5),s=255*((s-.5)*t+.5),c>255&&(c=255),0>c&&(c=0),g>255&&(g=255),0>g&&(g=0),s>255&&(s=255),0>s&&(s=0),e.data[n]=c,e.data[n+1]=g,e.data[n+2]=s}return this},Chobi.prototype.crossProcess=function(){this.imageData;return this.vintage(),this.brightness(10),this.contrast(50),this},Chobi.prototype.map=function(a,t,e,o,i){return(i-o)*(a-t)/(e-t)+o},Chobi.prototype.brightness=function(a){var t=this.imageData;a=this.map(a,-100,100,-255,255),console.log(a);for(var e=0;e<t.width;e++)for(var o=0;o<t.height;o++){var i=4*o*t.width+4*e,n=t.data[i],r=t.data[i+1],h=t.data[i+2];n+=a,r+=a,h+=a,n>255&&(n=255),0>n&&(n=0),r>255&&(r=255),0>r&&(r=0),h>255&&(h=255),0>h&&(h=0),t.data[i]=n,t.data[i+1]=r,t.data[i+2]=h}return this},Chobi.prototype.vintage=function(){for(var a=this.imageData,t=0;t<a.width;t++)for(var e=0;e<a.height;e++){var o=4*e*a.width+4*t,i=a.data[o],n=a.data[o+1],r=a.data[o+2];i=n,n=i,r=150,a.data[o]=i,a.data[o+1]=n,a.data[o+2]=r}return this.contrast(50),this},Chobi.prototype.canvas=null,Chobi.prototype.loadImageToCanvas=function(a){null==a&&null!=this.canvas&&(a=this.canvas);try{var t=this.imageData,e=a.getContext("2d");return a.width=t.width,a.height=t.height,e.putImageData(t,0,0),!0}catch(o){return!1}return this},Chobi.prototype.getImage=function(){var a=document.createElement("canvas"),t=a.getContext("2d");a.width=this.imageData.width,a.height=this.imageData.height,t.putImageData(this.imageData,0,0);var e=document.createElement("img");return e.src=a.toDataURL("image/png"),e},Chobi.prototype.crop=function(a,t,e,o){if(""==a||""==t||""==e||""==o)return console.log("Invalid crop parameters"),this;if(0>a||0>t||a>this.imageData.width||t>this.imageData.height||a+e>this.imageData.width||t+o>this.imageData.height)return console.log("Invalid crop parameters"),this;var i=document.createElement("canvas");this.loadImageToCanvas(i);var n=i.getContext("2d"),r=n.getImageData(a,t,e,o);return this.imageData=r,this},Chobi.prototype.download=function(a){""==a&&(a="untitled");var t=this.imageData,e=document.createElement("canvas"),o=e.getContext("2d");e.width=t.width,e.height=t.height,o.putImageData(t,0,0);var i=e.toDataURL("image/png").replace("image/png","image/octet-stream"),n=document.createElement("a");return"string"==typeof n.download?(document.body.appendChild(n),n.download=a+".png",n.href=i,n.click(),document.body.removeChild(n)):location.replace(uri),!0};
